(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))w(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&w(x)}).observe(document,{childList:!0,subtree:!0});function c(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function w(a){if(a.ep)return;a.ep=!0;const i=c(a);fetch(a.href,i)}})();const se="https://khytzjktxmqdaftjfmsq.supabase.co",ne="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtoeXR6amt0eG1xZGFmdGpmbXNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxOTc1NTAsImV4cCI6MjA2OTc3MzU1MH0.GXMY5r3cgivmcGBRULqDB5faBUTYR9jf3MHxt4dtfBc";supabase.createClient(se,ne);document.addEventListener("DOMContentLoaded",()=>{const L=document.getElementById("login-form"),g=document.getElementById("signup-form"),c=document.getElementById("show-signup"),w=document.getElementById("show-login");c.addEventListener("click",()=>{L.classList.add("hidden"),g.classList.remove("hidden")}),w.addEventListener("click",()=>{g.classList.add("hidden"),L.classList.remove("hidden")})});document.addEventListener("DOMContentLoaded",()=>{const c=supabase.createClient("https://khytzjktxmqdaftjfmsq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtoeXR6amt0eG1xZGFmdGpmbXNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxOTc1NTAsImV4cCI6MjA2OTc3MzU1MH0.GXMY5r3cgivmcGBRULqDB5faBUTYR9jf3MHxt4dtfBc"),w="abcdefghijklmnopqrstuvwxyz",a="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i="0123456789",x="!@#$%^&*()_+-=[]{}|;:,.<>?",T="a-very-secret-key-that-is-not-so-secret",S=document.getElementById("auth-container"),N=document.getElementById("auth-card"),b=document.getElementById("login-form"),A=document.getElementById("signup-form"),_=document.getElementById("show-signup"),j=document.getElementById("show-login"),R=document.getElementById("auth-error-login"),D=document.getElementById("auth-error-signup"),J=document.getElementById("logout-button"),q=document.getElementById("user-identifier"),M=document.getElementById("app-container"),m=document.getElementById("program-name"),E=document.getElementById("error-message"),h=document.getElementById("password-display"),r=document.getElementById("copy-button"),y=document.getElementById("copy-button-text"),z=document.getElementById("generate-button"),I=document.getElementById("password-list-container");let l=[],C=null;const O='<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>',F='<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" /></svg>',G='<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>',Y='<svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>',P=t=>CryptoJS.AES.encrypt(t,T).toString(),v=t=>{try{const s=CryptoJS.AES.decrypt(t,T).toString(CryptoJS.enc.Utf8);if(!s)throw new Error("Decryption resulted in empty string");return s}catch(e){return console.error("Failed to decrypt data",e),"복호화 오류"}},X=t=>new Date(t).toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(",",""),k=()=>{if(I.innerHTML="",l.length===0){I.innerHTML=`
                <div class="text-center py-10 px-4 h-full flex flex-col justify-center items-center">
                    <p class="text-slate-400">저장된 비밀번호가 없습니다.</p>
                    <p class="text-slate-500 text-sm mt-2">새 비밀번호를 생성하면 여기에 표시됩니다.</p>
                </div>`;return}[...l].sort((e,s)=>v(e.encryptedName).toLowerCase().localeCompare(v(s.encryptedName).toLowerCase())).forEach(e=>{const s=v(e.encryptedName),n=document.createElement("div");n.className="bg-slate-900/70 p-4 rounded-lg flex items-center justify-between gap-4 animate-fade-in",n.innerHTML=`
                <div class="flex-grow min-w-0">
                    <p class="font-semibold text-white break-words">${s}</p>
                    <div class="flex items-center gap-2 font-mono text-sm">
                        <span class="text-slate-300 w-24" data-id="${e.id}" data-role="password-text">********</span>
                        <button data-action="toggle" data-id="${e.id}" class="p-1 text-slate-400 hover:text-indigo-400 transition-colors" aria-label="Show password">${O}</button>
                    </div>
                    <p class="text-slate-500 text-xs mt-1">${X(e.timestamp)}</p>
                </div>
                <div class="flex items-center flex-shrink-0 gap-2">
                    <button data-action="copy" data-id="${e.id}" class="flex items-center px-2 py-1 text-xs font-semibold rounded-md transition-colors bg-slate-600 hover:bg-slate-500 text-slate-200">${Y}<span>복사</span></button>
                    <button data-action="delete" data-id="${e.id}" class="p-2 text-slate-400 hover:text-red-400 hover:bg-red-900/50 rounded-md transition-colors" aria-label="Delete password for ${s}">${G}</button>
                </div>
            `,I.appendChild(n)})},B=(t,e="login")=>{const s=e==="login"?R:D;s.textContent=t},H=async t=>{t.preventDefault(),B("","login");const e=b.elements["login-email"].value,s=b.elements["login-password"].value,{error:n}=await c.auth.signInWithPassword({email:e,password:s});n?B(n.message,"login"):b.reset()},$=async t=>{t.preventDefault(),B("","signup");const e=A.elements["signup-email"].value,s=A.elements["signup-password"].value,{error:n}=await c.auth.signUp({email:e,password:s});n?B(n.message,"signup"):alert("회원가입이 완료되었습니다. 로그인해주세요.")},Z=async()=>{const{error:t}=await c.auth.signOut();localStorage.removeItem("sb-khytzjktxmqdaftjfmsq-auth-token"),t&&t.message!=="Auth session missing!"&&console.error("Logout error:",t.message),location.reload()},K=async()=>{if(!C)return;const t=m.value.trim();if(!t){E.textContent="프로그램 이름을 입력해주세요.",m.classList.add("border-red-500");return}E.textContent="",m.classList.remove("border-red-500");let e=h.value;if(!e){const o=[w,a,i,x],d=Math.floor(Math.random()*9)+8,p=o.map(U=>U[Math.floor(Math.random()*U.length)]),f=o.join("");let te=Array.from({length:d-p.length},()=>f[Math.floor(Math.random()*f.length)]);e=[...p,...te].sort(()=>Math.random()-.5).join(""),h.value=e}r.disabled=!1,r.classList.remove("bg-slate-600","text-slate-400","cursor-not-allowed"),r.classList.add("bg-slate-700","hover:bg-slate-600","text-slate-200"),y.textContent="복사";const s=P(e),n=new Date().toISOString(),u=l.find(o=>v(o.encryptedName)===t);if(u){const{data:o,error:d}=await c.from("passwords").update({encrypted_password:s,timestamp:n}).eq("id",u.id).select();if(d)return alert("업데이트 실패: "+d.message);if(o&&o.length>0){const p=o[0];u.encryptedPassword=p.encrypted_password,u.timestamp=new Date(p.timestamp).getTime()}}else{const o={id:self.crypto.randomUUID(),user_id:C.id,encrypted_name:P(t),encrypted_password:s,timestamp:n},{data:d,error:p}=await c.from("passwords").insert(o).select();if(p)return alert("저장 실패: "+p.message);if(d&&d.length>0){const f=d[0];l.push({id:f.id,encryptedName:f.encrypted_name,encryptedPassword:f.encrypted_password,timestamp:new Date(f.timestamp).getTime()})}}k(),m.value="",h.value="",r.disabled=!0,r.classList.add("bg-slate-600","text-slate-400","cursor-not-allowed"),r.classList.remove("bg-slate-700","hover:bg-slate-600","text-slate-200"),y.textContent="복사"},V=()=>{h.value&&navigator.clipboard.writeText(h.value).then(()=>{y.textContent="복사됨!",r.classList.add("bg-green-600","text-white"),setTimeout(()=>{y.textContent="복사",r.classList.remove("bg-green-600","text-white"),r.classList.add("bg-slate-700","hover:bg-slate-600")},2e3)})},Q=async t=>{const e=t.target.closest("button[data-action]");if(!e)return;const{action:s,id:n}=e.dataset,u=l.find(o=>o.id===n);if(u){if(s==="delete"){const{error:o}=await c.from("passwords").delete().eq("id",n);if(o)return alert("삭제 실패: "+o.message);l=l.filter(d=>d.id!==n),k()}if(s==="copy"&&navigator.clipboard.writeText(v(u.encryptedPassword)).then(()=>{const o=e.querySelector("span");o.textContent="복사됨!",e.classList.add("bg-green-600","text-white"),setTimeout(()=>{o.textContent="복사",e.classList.remove("bg-green-600","text-white"),e.classList.add("bg-slate-600","hover:bg-slate-500")},2e3)}),s==="toggle"){const o=document.querySelector(`span[data-id='${n}'][data-role='password-text']`),d=o.textContent!=="********";o.textContent=d?"********":v(u.encryptedPassword),e.innerHTML=d?O:F}}},W=async t=>{C=t,q.textContent=t.email,S.classList.add("hidden"),M.classList.remove("hidden"),M.classList.add("animate-fade-in"),m.value="",h.value="",r.disabled=!0,r.classList.add("bg-slate-600","text-slate-400","cursor-not-allowed"),r.classList.remove("bg-slate-700","hover:bg-slate-600","text-slate-200"),y.textContent="복사";const{data:e,error:s}=await c.from("passwords").select("*").eq("user_id",t.id);s?(alert("데이터 로딩 실패: "+s.message),l=[]):l=e.map(n=>({id:n.id,encryptedName:n.encrypted_name,encryptedPassword:n.encrypted_password,timestamp:new Date(n.timestamp).getTime()})),k()},ee=()=>{C=null,M.classList.add("hidden"),S.classList.remove("hidden"),S.classList.add("animate-fade-in"),m.value="",h.value="",r.disabled=!0,r.classList.add("bg-slate-600","text-slate-400","cursor-not-allowed"),r.classList.remove("bg-slate-700","hover:bg-slate-600","text-slate-200"),y.textContent="복사"};b.addEventListener("submit",H),A.addEventListener("submit",$),J.addEventListener("click",Z),_.addEventListener("click",()=>N.classList.add("is-flipped")),j.addEventListener("click",()=>N.classList.remove("is-flipped")),z.addEventListener("click",K),r.addEventListener("click",V),I.addEventListener("click",Q),m.addEventListener("input",()=>{E.textContent&&(E.textContent="",m.classList.remove("border-red-500"))}),c.auth.onAuthStateChange((t,e)=>{e&&e.user?W(e.user):ee()})});
